<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="breadcrumb">
		<li><p:link outcome="/pages/invoicesearch">Invoice Search</p:link></li>
	</ui:define>

	<ui:define name="content">
	<h:form id="invSearchForm" prependId="false">
		<div class="ui-g ui-fluid">
			<div class="ui-g-12">
					<div class="card">
						<p:growl id="messages" closable="true" showDetail="true"/>
						<p:panel id="invSearchPnl" header="Search Criteria">
							<p:panelGrid columns="8" styleClass="ui-panelgrid-blank" layout="grid">
								<p:outputLabel for="invWoId" value="Work Order #:" style="font-weight:bold" />
								<p:inputText id="invWoId" value="#{invController.woNumber}" />
								<p:outputLabel for="invVendorId" value="Vendor Name: " style="font-weight:bold" />
								<p:inputText id="invVendorId" value="#{invController.vendorName}" />
								<p:outputLabel for="invNoId" value="LCEC Reference #:" style="font-weight:bold" />
								<p:inputText id="invNoId" value="#{invController.lcecRefNo}" />
								<p:outputLabel for="venRefId" value="Vendor Reference #:" style="font-weight:bold" />
								<p:inputText id="venRefId" value="#{invController.vendorRefNo}" />
								<p:outputLabel for="invSrchInvStatId" value="Invoice Status:" style="font-weight:bold" />
								<p:selectOneMenu id="invSrchInvStatId" value="#{invController.invoiceStatus}">
									<f:selectItem itemLabel="All" itemValue="" noSelectionOption="true" />
									<f:selectItems value="#{streetLightVw.invoiceStatus}" var="stat" itemLabel="#{stat.description}" itemValue="#{stat.invoiceStatusId}" />
								</p:selectOneMenu>
								<p:outputLabel for="invWoTypeId" value="Work Order Type:" style="font-weight:bold" />
								<p:selectOneMenu id="invWoTypeId" value="#{invController.woType}">
									<f:selectItem itemLabel="All" itemValue="" noSelectionOption="true" />
									<f:selectItem itemLabel="Staking" itemValue="SS" />
									<f:selectItem itemLabel="Streetlight" itemValue="SL" />
								</p:selectOneMenu>
								<p:commandButton value="Search" icon="ui-icon-check" update="invSearchForm,invTbl" action="#{invController.findInvoices}" />
							</p:panelGrid>
						</p:panel>
					</div>
				</div>
			<div class="ui-g-12">
				<div class="card">					
				<p:dataTable id="invTbl" var="inv" value="#{invController.invoice}" reflow="true" style="margin-top:10px"
								paginator="true" rows="50" rowsPerPageTemplate="50,75,100" draggableColumns="true">
					<f:facet name="header">
					<div style="float: left">
						<p:graphicImage id="helpId" name="/images/Helpbtn.png" style="width:25px; height:25px;"/>	
						 <p:tooltip for="helpId" value="There are 4 options for position" position="right">
						 	<h3>Invoice Type</h3>
							<h4>**SL = STREET LIGHT</h4>
							<h4>**SS = STAKING</h4>
						 </p:tooltip>
					</div>				
        					<p:panelGrid styleClass="ui-panelgrid-blank">
        					<div style="float: right">
            				<p:commandButton id="toggler" type="button"  icon="fa fa-align-left" style="float: right" value="Columns" />
        					<p:columnToggler datasource="invTbl" trigger="toggler" />
            				</div>
            				</p:panelGrid>
    					</f:facet>
        		<p:column headerText="Action" style="text-align:center" rendered="#{userMBean.currentUser.isPermitted('INV:Approve') or userMBean.currentUser.isPermitted('SL:Approve')}">
        			<h:commandLink action="#{wfController.findInvoiceApproval}" value="Approve" rendered="#{inv.invoiceStatus.description == 'Submitted' and inv.invoiceType == 'SS' and userMBean.currentUser.isPermitted('INV:Approve')}">
						<f:setPropertyActionListener target="#{wfController.invoiceId}" value="#{inv.invoiceId}" />
						<f:setPropertyActionListener target="#{invController.renderBackToInvoiceSearch}"  value="true" />
    					<f:setPropertyActionListener target="#{wfController.renderBackToInvoiceTab}" value="false" />
					</h:commandLink>
					<h:commandLink action="#{streetLightVw.findInvoiceApproval}" value="Approve" rendered="#{inv.invoiceStatus.description == 'Submitted' and inv.invoiceType == 'SL' and userMBean.currentUser.isPermitted('SL:Approve')}">
						<f:setPropertyActionListener target="#{streetLightVw.invNoLink}" value="#{inv.invoiceId}" />
						<f:setPropertyActionListener target="#{invController.renderBackToInvoiceSearch}"  value="true" />
    					<f:setPropertyActionListener target="#{wfController.renderBackToInvoiceTab}" value="false" />
					</h:commandLink>
        		</p:column>
				<p:column headerText="LCEC Reference" style="text-align:center"  sortBy="#{inv.invoiceId}" filterBy="#{inv.invoiceId}">
				<h:commandLink action="#{wfController.findInvoiceDetail(inv.invoiceId)}" value="#{inv.invoiceId}" rendered="#{inv.invoiceType eq 'SS'}" >
					<f:setPropertyActionListener target="#{wfController.invoiceId}" value="#{inv.invoiceId}"/>
					<f:setPropertyActionListener target="#{invController.renderBackToInvoiceSearch}"  value="true" />
    				<f:setPropertyActionListener target="#{wfController.renderBackToInvoiceTab}" value="false" />
				</h:commandLink>
				<h:commandLink action="#{streetLightVw.slInvoiceDetail}" value="#{inv.invoiceId}" rendered="#{inv.invoiceType eq 'SL'}">
					<f:setPropertyActionListener target="#{streetLightVw.invNoLink}" value="#{inv.invoiceId}"/>
					<f:setPropertyActionListener target="#{invController.renderBackToInvoiceSearch}"  value="true" />
    				<f:setPropertyActionListener target="#{wfController.renderBackToInvoiceTab}" value="false" />
    				<f:setPropertyActionListener target="#{streetLightVw.renderBackToStreetLightBtn}" value="false" />
				</h:commandLink>
				</p:column>
				<p:column headerText="Vendor Reference" style="text-align:center" sortBy="#{inv.vendorReference}" filterBy="#{inv.vendorReference}">
					<h:outputText value="#{inv.vendorReference}" />
				</p:column>
				<p:column headerText="Invoice Date" style="text-align:center" sortBy="#{inv.invoicedDt}" filterBy="#{inv.invoicedDt}">
					<h:outputText value="#{inv.invoicedDt}">
						<f:convertDateTime pattern = "MM-dd-yyyy hh:mm:ss a" />
					</h:outputText>
				</p:column>
				<p:column headerText="Invoice Status" style="text-align:center" sortBy="#{inv.invoiceStatus.description}" filterBy="#{inv.invoiceStatus.description}">
					<h:outputText value="#{inv.invoiceStatus.description}" />
				</p:column>
				<p:column headerText="Invoiced Amount" style="text-align:center" sortBy="#{inv.invoiceAmount}" filterBy="#{inv.invoiceAmount}">
					<h:outputText value="#{inv.invoiceAmount}">
						<f:convertNumber type="currency" currencySymbol="$" />
					</h:outputText>
				</p:column>
				<p:column headerText="Work Order" style="text-align:center" sortBy="#{inv.workOrderId}" filterBy="#{inv.workOrderId}">
					<h:outputText value="#{inv.workOrderId}" />
				</p:column>
				<p:column headerText="Vendor" style="text-align:center" sortBy="#{inv.vendorName}" filterBy="#{inv.vendorName}">
					<h:outputText value="#{inv.vendorName}" />
				</p:column>
				<p:column headerText="Invoiced Type" style="text-align:center" sortBy="#{inv.invoiceType}" filterBy="#{inv.invoiceType}">
					<h:outputText value="#{inv.invoiceType}" />
				</p:column>
				<p:column headerText="Invoiced By" style="text-align:center" sortBy="#{inv.invoicedBy}" filterBy="#{inv.invoicedBy}">
					<h:outputText value="#{inv.invoicedBy}" />
				</p:column>
				<p:column headerText="Invoiced Approval Date" style="text-align:center" sortBy="#{inv.approvedDt}" filterBy="#{inv.approvedDt}">
					<h:outputText value="#{inv.approvedDt}">
						<f:convertDateTime pattern = "MM-dd-yyyy hh:mm:ss a" />
					</h:outputText>
				</p:column>
				<p:column headerText="Invoiced Approval By" style="text-align:center" sortBy="#{inv.approvedBy}" filterBy="#{inv.approvedBy}">
					<h:outputText value="#{inv.approvedBy}" />
				</p:column>
			</p:dataTable>
				<p:dialog id="newInvoiceDlgId" header="Select Work Orders for Invoice" closable="false" draggable="false"
							modal="true" resizable="false" showHeader="true" widgetVar="newInvoiceDlg" minHeight="40">
					<ui:include src="newinvoicediag.xhtml" />
				</p:dialog>
				</div>
			</div>
		</div>
		</h:form>
	</ui:define>
</ui:composition>